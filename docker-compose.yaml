---
version: "3.8"

services:
  gitwatch:
    # Pull the latest official image from the gitwatch repository on GitHub Container Registry
    image: ghcr.io/gitwatch/gitwatch:latest
    restart: always
    volumes:
      # The local directory on your machine that you want to watch
      # IMPORTANT: You must create this directory first (e.g., ./my-notes-repo)
      - ./watched-repo:/app/watched-repo

      # Mount your SSH private key for pushing to remote repositories
      # Example uses id_ed25519; you might use id_rsa or another key.
      - ~/.ssh/id_ed25519:/home/appuser/.ssh/id_ed25519:ro

      # Mount your git config to use your correct user name and email for commits
      - ~/.gitconfig:/home/appuser/.gitconfig:ro

      # OPTIONAL: If your repo's .git directory is separate (e.g., for volume mounts)
      # - /path/to/external/.git:/app/.git
    environment:
      # --- User Configuration (Recommended for host volume mounts) ---
      # Set to your host user's UID (run `id -u` on your host)
      PUID: 1000
      # Set to your host user's GID (run `id -g` on your host)
      # This is critical for file permissions on mounted volumes.
      PGID: 1000 # Example GID, change this to your host's GID

      # --- Watched Directory ---
      # This should match the container path in the 'volumes' section above
      GIT_WATCH_DIR: /app/watched-repo

      # --- Git Remote Configuration ---
      # The remote repository to push to (e.g., 'origin')
      GIT_REMOTE: origin
      # The branch to push to (e.g., 'main' or 'master')
      GIT_BRANCH: main
      # The path to an external .git directory (used with -g flag in gitwatch.sh)
      # If your .git folder is mounted separately, set this to the container path (e.g., /app/.git)
      GIT_EXTERNAL_DIR: ""
      # NEW: Timeout in seconds for critical Git operations (commit, pull, push) (-t)
      GIT_TIMEOUT: 60
      # Set to "true" to run 'git pull --rebase' before every push (-R)
      PULL_BEFORE_PUSH: "false"

      # --- Gitwatch Behavior ---
      # Time in seconds to wait after a file change before committing (-s)
      SLEEP_TIME: 2
      # The commit message format. %d is replaced with the date/time (-m)
      COMMIT_MSG: "Auto-commit: %d"
      # The date format used in the commit message (see 'man date' for options) (-d)
      DATE_FMT: "+%Y-%m-%d %H:%M:%S"
      # OPTIONAL: Custom command to generate the commit message (-c). Overrides COMMIT_MSG.
      COMMIT_CMD: ""
      # OPTIONAL: Set to "true" to pipe the list of changed files to COMMIT_CMD (-C)
      PASS_DIFFS: "false"
      # OPTIONAL: Events passed to inotifywait/fswatch (-e)
      EVENTS: ""
      # A comma-separated list of patterns to exclude from monitoring (e.g., "*.log,*.tmp,tmp/") (-X)
      EXCLUDE_PATTERN: ""
      # Raw regex patterns to exclude from monitoring (e.g., "(.*)\.bak$") (-x)
      RAW_EXCLUDE_REGEX: ""
      # Set to "true" to prevent commits when a merge is in progress (-M)
      SKIP_IF_MERGING: "false"
      # Set to "true" to commit any pending changes on startup (-f)
      COMMIT_ON_START: "false"
      # Set to "true" to enable verbose output for debugging (-v)
      VERBOSE: "false"
      # NEW: Set to "true" to suppress all stdout/stderr output (-q)
      QUIET: "false"
      # Set to "true" to log all messages to syslog (-S)
      USE_SYSLOG: "false"
      # NEW: Set to "true" to disable file locking (-n).
      DISABLE_LOCKING: "false"
      # NEW: Overrides the default 150-character truncation for commit log lines
      GW_LOG_LINE_LENGTH: 150
